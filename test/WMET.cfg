# TDR selection procedure for W->MuNu events
# Tested on 2007/10/04/ by J.A.

process WmunuSelector= {

                                                                                                          
### keep the logging output to a nice level ###
      #include "FWCore/MessageLogger/data/MessageLogger.cfi"

      service = MessageLogger {
          untracked vstring destinations = { "cout" }
          untracked PSet cout = { untracked string threshold = "DEBUG" }
          #untracked vstring debugModules = { "wMuNuSelFilter", "wMuNuIsolations" }
          #untracked vstring debugModules = { "wMuNuSelFilter", "wmet" }
          untracked vstring debugModules = { "wmet" }
      }

      service = AdaptorConfig {}

      #untracked PSet maxEvents = { untracked int32 input = 10 }
      untracked PSet maxEvents = { untracked int32 input = 10000 }

      source = PoolSource {
            untracked vstring fileNames = {
                  //13x
                  //"/store/mc/2007/4/26/Spring07-Wmunu-1352/0002/0033C29A-C8FB-DB11-82AB-003048769D4B.root"
                  //16x
                  //"/store/mc/2007/9/11/RelVal-RelValWM-1189470504/0000/0A921F9A-5661-DC11-A0EB-003048769FD1.root"
                  //"rfio:/castor/cern.ch/user/j/jalcaraz/crab/RelVal160pre14Z-MM_Raw.root"
                  "/store/mc/2007/10/6/RelVal-CSA07Muon-PDMuon-Skims0-B01/0000/96B66F60-2274-DC11-A0E6-0016177CA778.root"
            }
            untracked uint32 debugVerbosity = 0
            untracked bool   debugFlag     = false
      }
      ## Selection of WToMuNu
      //include "ElectroWeakAnalysis/WReco/data/WMuNuSel_NewIso_16x.cff"
      module wMuNuIsolations = L3MuonIsolations from "RecoMuon/L3MuonIsolationProducer/data/L3MuonIsolationProducer.cfi"
      replace wMuNuIsolations.inputMuonCollection = globalMuons      
      replace wMuNuIsolations.CutsPSet.EtaBounds = { 999.9 }
      replace wMuNuIsolations.CutsPSet.ConeSizes = { 0.3 }
      replace wMuNuIsolations.CutsPSet.Thresholds = { 3.0 }
      replace wMuNuIsolations.OutputMuIsoDeposits = false
      replace wMuNuIsolations.ExtractorPSet.inputTrackCollection = ctfWithMaterialTracks

      module wMuNuSelFilter = WToMuNuSelector {
            InputTag MuonTag = globalMuons
            InputTag METTag = met
            InputTag JetTag = iterativeCone5CaloJets
            InputTag IsolationTag = wMuNuIsolations

            double PtThrForZCount = 20.
            double PtCut = 20.
            double EtaCut = 2.0
            double MassTMin = 0.
            double MassTMax = 200.
            double EJetMin = 40.
            int32 NJetMax = 3
            double AcopCut = 1.0
      }

      sequence wmunusel = { wMuNuIsolations, wMuNuSelFilter }
      
      service = RandomNumberGeneratorService {
	    PSet moduleSeeds = {
      		untracked uint32 wmet = 12345	
	    }
      }
	                                                                                                     
      ## WMET analyzer
      //module wmet = WMETAnalyzer {
      //      //untracked InputTag GeneratorCollectionLabel = NONE
      //      untracked InputTag GeneratorCollectionLabel = genParticleCandidates
      //      //untracked InputTag MuonCollectionLabel = globalMuons
      //      untracked InputTag MuonCollectionLabel = wMuNuSelFilter
      //      untracked InputTag METCollectionLabel = met
      //      untracked string InputRootFileName = "ZMET.root"
      //      untracked string OutputRootFileName = "WMET.root"
      //}

      module wmet = WMETType2Analyzer {
            untracked InputTag GeneratorCollectionLabel = genParticleCandidates
            untracked InputTag MuonCollectionLabel = wMuNuSelFilter
            untracked InputTag METCollectionLabel = met
            untracked string InputRootFileName = "ZMET.root"
            untracked string OutputRootFileName = "WMET.root"
      }
	
      path wmunu = { wmunusel, wmet }
      //path wmunu = {wmunusel}

      block TestEventContent = {
        untracked vstring outputCommands = {
                'drop *',
                'keep *_*_*_WmunuSelector' 
        }
      }

      module wToMuNuOutput = PoolOutputModule {
        untracked string fileName = "wToMuNu.root"
        #using AODSIMEventContent
        using TestEventContent
        untracked PSet SelectEvents = {
                vstring SelectEvents = {"wmunu"}
        }
        untracked PSet dataset ={
                untracked string dataTier = "USER"
                untracked string filterName = "wToMuNu_Selector"
        }
      }
      //endpath end = { wToMuNuOutput }	

}
                                                                                                          

